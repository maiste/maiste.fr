<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Maiste.fr</title>
    <link href="/static/css/main.css" rel="stylesheet" />
    <link rel="me" href="https://fosstodon.org/@maiste" />

    <!-- FIXME: replace me with a local version of the fonts i.e. NO GOOGLE -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@100..900&family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&display=swap"
        rel="stylesheet">
    <!-- FIXME: replace me with local version of the css + script load from local. -->
    <link href="/static/css/code.css" rel="stylesheet" type="text/css" />
    <script src="/static/script/highlight.min.js"></script>
</head>

<body>
    <!-- Umami -->
    <script defer src="https://analytics.maiste.fr/script.js"
        data-website-id="b1e6219d-8044-47d9-9e91-44db862e2732"></script>
    <!-- End Umami Code -->

    <header class="container">
        <nav>
            <h2><a href="/">Maiste ðŸŒ±</a></h2>
            <ul>
                <li><a href="/blog">Blog</a></li>
                <li><a href="/wiki">Wiki</a></li>
                <li><a href="/about">About</a></li>
            </ul>
        </nav>
        <hr />
    </header>
    <main class="container"><h1>Doc on GitHub pages with Odoc and Actions</h1>
<div class="metadata">
    <p>date: 2021-08-20</p>
    <p>lang: EN
    </p>
</div>
<p><h2>Context</h2>
<p>I will not surprise anyone if I say that documenting your code is important.
If you host your code on GitHub, you might have heard about <a href="https://pages.github.com/">GitHub Pages</a>.
This project allows GitHub users to deploy some static websites using GitHub.
For example, <a href="maiste.fr">this website</a> is stored on my GitHub account.</p>
<p>An interesting point is that you can use this feature to store piece of
documentations at a specific URL. If your OCaml code is on GitHub, you can
deploy the configuration the way I will show you.</p>
<p>First, your code must follow the <a href="https://ocaml.org/manual/ocamldoc.html">ocamldoc</a> convention. Also,
the <a href="https://opam.ocaml.org/packages/odoc/">odoc</a> generator must be in your package dependencies (maybe with the
<code>{with-doc}</code> specification.</p>
<p>Below, you can see a partial example of a <code>.opam</code>, I have created:</p>
<pre><code class="language-ocaml">depends: [
  &quot;ocaml&quot; {&gt;= &quot;4.12.0&quot;}
  &quot;dune&quot; {&gt;= &quot;2.5&quot;}
  &quot;odoc&quot; {with-doc}
]
build: [
  [&quot;dune&quot; &quot;subst&quot;] {pinned}
  [
    &quot;dune&quot;
    &quot;build&quot;
    &quot;-p&quot;
    name
    &quot;-j&quot;
    jobs
    &quot;@install&quot;
    &quot;@runtest&quot; {with-test}
    &quot;@doc&quot; {with-doc}
  ]
]
</code></pre>
<p>Now we have our documentation, it's time to automatize the process with
GitHub Actions.</p>
<h2>Setup GitHub Actions</h2>
<p>At the root of your repository, you must create (if it's not already the case)
a <strong>.github/workflows/</strong> directory. In it, you must create a <name>.yml file.
The content of the file is:</p>
<pre><code class="language-yaml">name: &lt;Display title&gt;

on:
  push:
    branches:
    - &lt;Regex describing the branch on which this action must be trigger&gt;

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - uses: ocaml/setup-ocaml@v2
        with:
          ocaml-compiler: '&lt;version number&gt;'
      - name: Dependencies
        run: opam install -d . --deps-only
      - name: Building docs
        run: opam exec -- dune build @doc
      - name: Deploying to github pages
        uses: peaceiris/actions-gh-pages@v3
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          publish_dir: &lt;./_build/default/_doc/_html/ or directory where your doc is stored&gt;
          [destination_dir: no_mammut] &lt;optional: push the doc in a different directory&gt;
          [enable_jekyll: true] &lt;optional: allow jekyll like website&gt;
</code></pre>
<p>Thanks to this file, each time the action is triggered, it will push a new commit in the
<code>gh-pages</code> branch of your repository.</p>
<h2>Take the mouse back and update GitHub</h2>
<ul>
<li>
<p>You need to go to your repository settings:</p>
<p><img src="/2021/tuto_odoc/github_1.png" alt="Github settings" ></p>
</li>
<li>
<p>Then, you must go to the <strong>Pages</strong> settings:</p>
<p><img src="/2021/tuto_odoc/github_2.png" alt="Github Pages" ></p>
</li>
<li>
<p>Finally, you must select the branch on which your pages are built. Here it is
<code>gh-pages</code>:</p>
<p><img src="/2021/tuto_odoc/github_3.png" alt="Github branch" ></p>
</li>
</ul>
<p>And, you are done! If everything has worked well you can check your documentation at: <br />
<strong>&lt;user&gt;.github.io/&lt;repo name&gt;/</strong>.</p>
<h2>Conclusion</h2>
<p>I hope this tutorial can be useful to you! Feel free to send me correction if
I have made a mistake.</p>
</p>
</main>

    <footer class="container">
        <hr />
        <p> Website written proudly with <a href="https://gitlab.com/funkywork/yocaml">Yocaml</a> â™¡ This site is part of
            the
            <a href="https://ring.muhokama.fun">Muhokama ring</a>
            (<a href="https://ring.muhokama.fun/u/maiste/pred">Previous</a> - <a
                href="https://ring.muhokama.fun/u/maiste/succ">Next</a>)
        </p>
        <p><a href="https://maiste.fr">Content under this website</a> is written by Etienne "Maiste" Marais and is
            licensed
            under <a href="https://creativecommons.org/licenses/by-nc/4.0/?ref=chooser-v1">CC BY-NC 4.0</a></p>
    </footer>

    <script>hljs.highlightAll();</script>
</body>

</html>
